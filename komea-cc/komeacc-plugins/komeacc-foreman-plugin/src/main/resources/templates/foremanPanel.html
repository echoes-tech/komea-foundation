<div class="alert alert-danger" role="alert" th:text="${foremanError}" th:if="${foremanError != null}">
</div>
<table class="table table-striped">
	<thead>
		<tr>
			<th>Name</th>
			<th>Operating System</th>
			<th>
				<div class="text-right"></div>
			</th>
		</tr>
	</thead>
	<tbody>
		<tr th:each="target, row: ${targets}">
			<td th:text="${target.getName()}"></td>
			<td th:text="${target.getOperatingSystemName()}"></td>
			<td class="text-right">
				<!-- a th:href="'/ui/foreman/targets/instantiate?projectId=' + ${projectId} + '&amp;targetId=' + ${target.getId()}" class="btn btn-default glyphicon glyphicon-play" role="button">&nbsp;Instantiate</a -->
				<button type="button" class="btn btn-default glyphicon glyphicon-play btn-instantiate" role="button" th:attr="data-targetId=${target.getId()}" data-toggle="modal" data-target="#instantiateHostModal">&nbsp;Instantiate</button>				
			</td>
		</tr>
	</tbody>
</table>
<div aria-hidden="true" aria-labelledby="myModalLabel" class="modal fade in" id="createTargetModal" role="dialog" tabindex="-1">
   <div class="modal-dialog">
     <div class="modal-content">
       <div class="modal-header">
         <button aria-hidden="true" class="close" data-dismiss="modal" type="button">&times;</button>
         <h4 class="modal-title" id="myModalLabel">Create Target</h4>
       </div>
       <form action="/ui/foreman/targets/new" class="form-horizontal" id="new_target" method="post" role="form" data-toggle="validator">
       	<div class="modal-body">   	 
           <div class="alert alert-info alert-dismissible" role="alert">
			  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			  This widget allows to create a <strong>Target</strong>. A Target is a configuration that will be used afterward to create new VMs instantly. <br/>
			  To create a target, you will need to specify :
			  <ul>
			  	<li><strong>a Name</strong> : This is how you want to call the Target.</li>
			  	<li><strong>an Environment</strong> : This is the set of Puppet modules you want to apply on the Target.</li>
			  	<li><strong>an Operating System</strong> : This is the Operating System you want for the future VM.</li>
			  	<li><strong>a Compute Profile</strong> : This is the kind of VM you want to create.</li>
			  	<li><strong>the parameters</strong> for the specific environment you choosed. The field is prefilled with the default values from the Puppet modules embedded in the selected Environment.</li>
			  </ul>
			</div>
           <div class="form-group">
             <label class="control-label col-sm-2" for="name" required="true">Name:</label>
             <div class="col-sm-10">
               <input class="form-control" id="name" name="name" placeholder="Target name" type="text" required="required"/>
             </div>
           </div>
           <div class="form-group">
             <label class="control-label col-sm-2" for="source">Environment</label>
             <div class="col-sm-10">
               <select class="form-control" id="environment" name ="environment" onchange="selectTargetEnvironment()">
               		<option value=""></option>
					<option th:each="env : ${environments}" th:value="${env.id}" th:text="${env.name}"></option>
               </select>
             </div>
           </div>
           <div class="form-group">
             <label class="control-label col-sm-2" for="operatingsystem">Operating System</label>
             <div class="col-sm-10">
               <select class="form-control" id="operatingsystem" name="operatingsystem">
                 <option th:each="operatingSystem : ${operatingSystems}"
                        th:value="${operatingSystem.id} + '-' + ${operatingSystem.title}" th:text="${operatingSystem.title}"></option>

               </select>
             </div>
           </div>
           <div class="form-group">
             <label class="control-label col-sm-2" for="computeprofiles" name="computeprofiles">Compute Profiles</label>
             <div class="col-sm-10">
               <select class="form-control" id="computeprofiles" name="computeprofiles">
                 <option th:each="computeProfile : ${computeProfiles}"
                        th:value="${computeProfile.id}" th:text="${computeProfile.name}"></option>
               </select>
             </div>
           </div>
           <div class="form-group">
             <div class="col-sm-12">
               <textarea class="form-control" id="puppetConfiguration" name="puppetConfiguration" rows="15" placeholder="In this text field, you can set the parameters for the specific environment you choosed. The field is prefilled with the default values from the Puppet modules embedded in the selected Environment."></textarea>
             </div>
           </div>           
           <input name="projectId" type="hidden" th:value="${projectId}"/>        
       	</div>
       	<div class="modal-footer">
         	<button class="btn btn-default" data-dismiss="modal" type="button">Cancel</button>
			<button class="btn btn-primary" type="submit">Create</button>
       	</div>
       </form>
     </div>
   </div>
 </div>
 <div aria-hidden="true" aria-labelledby="myModalLabel" class="modal fade in" id="createEnvModal" role="dialog" tabindex="-1" style="padding-left: 15px;">
   <div class="modal-dialog">
     <div class="modal-content">
       <div class="modal-header">
         <button aria-hidden="true" class="close" data-dismiss="modal" type="button">&times;</button>
         <h4 class="modal-title" id="myModalLabel">Create Environment</h4>
       </div>
       <form action="/ui/foreman/environment/new" class="form-horizontal" id="new_env" method="post" role="form" data-toggle="validator">
	       <div class="modal-body">	         
	           <div class="form-group">
	             <label class="control-label col-sm-2" for="source">Source Environment</label>
	             <div class="col-sm-10">
	               <select class="form-control" id="env_source" onchange="selectSource()">
	               	<option value=""></option>
	               	<option th:each="env : ${environments}" th:value="${env.id}" th:text="${env.name}"></option>
	               </select>
	             </div>
	           </div>
	           <div class="form-group">
	           	<label class="control-label col-sm-2" for="source">Name</label>
	            <div class="col-sm-10">
	               <input class="form-control" id="envName" name="name" placeholder="Environment Name" type="text" required="required"/>
	            </div>
	           </div>
	           <div class="form-group">
	             <div class="col-sm-12">
	               <textarea class="form-control" id="env_configuration" name="configuration" rows="15" required="required">{
  "modules": [
    {
      "name": "",
      "version": ""
    }
  ]
}
	               </textarea>
	             </div>
	           </div>
	           <input name="projectId" type="hidden" th:value="${projectId}"/>	        
	       </div>
	       <div class="modal-footer">
	         <button class="btn btn-default" data-dismiss="modal" type="button">Cancel</button>
	         <button class="btn btn-primary" type="submit">Create</button>
	       </div>
     </form>
    </div>
  </div>
</div>


 <div aria-hidden="true" aria-labelledby="myModalLabel" class="modal fade in" id="instantiateHostModal" role="dialog" tabindex="-1" style="padding-left: 15px;">
   <div class="modal-dialog">
     <div class="modal-content">
       <div class="modal-header">
         <button aria-hidden="true" class="close" data-dismiss="modal" type="button">&times;</button>
         <h4 class="modal-title" id="myModalLabel">Instantiate Host</h4>
       </div>
       <div class="modal-body">
         <form action="/ui/foreman/targets/instantiate" class="form-horizontal" id="instantiate_host" method="post" role="form"  data-toggle="validator">
           <div class="form-group">
            <label class="control-label col-sm-2" for="hostName">Name</label>
              <div class="col-sm-10">
                <input class="form-control" id="hostName" name="hostName" placeholder="Host Name" type="text" required="required"/>
              </div>
            <input name="projectId" type="hidden" th:value="${projectId}"/>
            <input name="targetId" id="targetId" type="hidden" value="" />
           </div>
	       <div class="modal-footer">
    	     <button class="btn btn-default" data-dismiss="modal" type="button">Cancel</button>
        	 <button class="btn btn-primary" type="submit">Instantiate</button>
       		</div>
         </form>
       </div>
     </div>
   </div>
 </div>
 
<script type="text/javascript">

	document.addEventListener("DOMContentLoaded", function(event) { 
	
		$(".btn-instantiate").click(function() {
			 var targetId = $(this).attr("data-targetId");
			 alert
			 $("#targetId").attr("value", targetId);
		});	

	});	

	function displayCreateTargetModal() {
		$('#createTargetModal').modal('show');
	}
	
	function displayCreateEnvModal() {
		$('#createEnvModal').modal('show');
	}
	
	function selectTargetEnvironment() {
		var sourceId = $('#environment').val();
		if (sourceId != "") {
		
			$.get("/rest/foreman/puppet_class_parameters/"+sourceId, function(data) {
				if (data) {
					$('#puppetConfiguration').val(data);
				}
			});
		}else{
			$('#env_configuration').val("");
		}
	}	
	
	function selectSource() {
		var sourceId = $('#env_source').val();
		if (sourceId != "") {
			$.get("/rest/foreman/environments/"+sourceId, function(data) {
				if (data) {
					$('#env_configuration').val(data.configuration);
				}
			});
		}else{
			$('#env_configuration').val("");
		}
	}
	
</script>
