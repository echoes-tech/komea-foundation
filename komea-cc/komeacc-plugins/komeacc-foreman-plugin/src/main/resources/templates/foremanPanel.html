<div class="alert alert-danger" role="alert" th:text="${foremanError}" th:if="${foremanError != null}">
</div>
<table class="table table-striped">
	<thead>
		<tr>
			<th>Name</th>
			<th>Operating System</th>
			<th>
				<div class="text-right"></div>
			</th>
		</tr>
	</thead>
	<tbody>
		<tr th:each="target, row: ${targets}">
			<td th:text="${target.getName()}"></td>
			<td th:text="${target.getOperatingSystemName()}"></td>
			<td class="text-right">
				<a class="btn btn-default glyphicon glyphicon-pencil" disabled="disabled">&nbsp;Edit</a>				
				<button type="button" class="btn btn-default glyphicon glyphicon-play btn-instantiate" role="button" th:attr="data-targetId=${target.getId()}" data-toggle="modal" data-target="#instantiateHostModal">&nbsp;Instantiate</button>				
			</td>
		</tr>
	</tbody>
</table>
<div aria-hidden="true" aria-labelledby="myModalLabel" class="modal fade in" id="createTargetModal" role="dialog" tabindex="-1">
   <div class="modal-dialog">
     <div class="modal-content">
       <div class="modal-header">
         <button aria-hidden="true" class="close" data-dismiss="modal" type="button">&times;</button>
         <h4 class="modal-title" id="myModalLabel">Create Target</h4>
       </div>
       <form th:attr="action=@{/ui/foreman/targets/new}" class="form-horizontal" id="new_target" method="post" role="form" data-toggle="validator">
       	<div class="modal-body">   	 
           <div class="alert alert-info alert-dismissible" role="alert">
			  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			  This widget allows to create a <strong>Target</strong>. A Target is a configuration that will be used afterward to create new VMs instantly. <br/>
			  To create a target, you will need to specify :
			  <ul>
			  	<li><strong>a Name</strong> : This is how you want to call the Target.</li>
			  	<li><strong>an Environment</strong> : This is the set of Puppet modules you want to apply on the Target.</li>
			  	<li><strong>an Operating System</strong> : This is the Operating System you want for the future VM.</li>
			  	<li><strong>a Compute Profile</strong> : This is the kind of VM you want to create.</li>
			  	<li><strong>the parameters</strong> for the specific environment you choosed. The field is prefilled with the default values from the Puppet modules embedded in the selected Environment.</li>
			  </ul>
			</div>
           <div class="form-group">
             <label class="control-label col-sm-2" for="name" required="true">Name:</label>
             <div class="col-sm-10">
               <input class="form-control" id="name" name="name" placeholder="Target name" type="text" required="required"/>
             </div>
           </div>
           <div class="form-group">
             <label class="control-label col-sm-2" for="source">Environment</label>
             <div class="col-sm-10">
               <select class="form-control" id="environment" name ="environment">
               		<option value=""></option>
					<option th:each="env : ${environments}" th:value="${env.id}" th:text="${env.name}"></option>
               </select>
             </div>
           </div>
           <div class="form-group">
             <label class="control-label col-sm-2" for="operatingsystem">Operating System</label>
             <div class="col-sm-10">
               <select class="form-control" id="operatingsystem" name="operatingsystem">
                 <option th:each="operatingSystem : ${operatingSystems}"
                        th:value="${operatingSystem.id} + '-' + ${operatingSystem.title}" th:text="${operatingSystem.title}"></option>

               </select>
             </div>
           </div>
           <div class="form-group">
             <label class="control-label col-sm-2" for="computeprofiles" name="computeprofiles">Compute Profiles</label>
             <div class="col-sm-10">
               <select class="form-control" id="computeprofiles" name="computeprofiles">
                 <option th:each="computeProfile : ${computeProfiles}"
                        th:value="${computeProfile.id}" th:text="${computeProfile.name}"></option>
               </select>
             </div>
           </div>
           <div class="form-group">
             <div class="col-sm-12">
               <textarea class="form-control" id="puppetConfiguration" name="puppetConfiguration" rows="15" placeholder="In this text field, you can set the parameters for the specific environment you choosed. The field is prefilled with the default values from the Puppet modules embedded in the selected Environment." disabled="true">
{
  "modules" : {
    "apache" : {
      "puppetClasses" : {
        "apache" : {
          "parameters" : {
            "allow_encoded_slashes" : {
              "id" : "206",
              "value" : "",
              "override" : false
            },
            "default_ssl_cert" : {
              "id" : "157",
              "value" : "${$::apache::params::default_ssl_cert}",
              "override" : false
            },
            "default_type" : {
              "id" : "164",
              "value" : "none",
              "override" : false
            },
            "apache_name" : {
              "id" : "150",
              "value" : "${$::apache::params::apache_name}",
              "override" : false
            },
            "default_ssl_chain" : {
              "id" : "159",
              "value" : "",
              "override" : false
            },
            "default_ssl_vhost" : {
              "id" : "156",
              "value" : false,
              "override" : false
            },
            "default_confd_files" : {
              "id" : "155",
              "value" : true,
              "override" : false
            },
            "confd_dir" : {
              "id" : "180",
              "value" : "${$::apache::params::confd_dir}",
              "override" : false
            },
            "conf_template" : {
              "id" : "187",
              "value" : "${$::apache::params::conf_template}",
              "override" : false
            },
            "apache_version" : {
              "id" : "202",
              "value" : "${$::apache::version::default}",
              "override" : false
            },
            "conf_dir" : {
              "id" : "179",
              "value" : "${$::apache::params::conf_dir}",
              "override" : false
            },
            "default_charset" : {
              "id" : "154",
              "value" : "",
              "override" : false
            },
            "default_mods" : {
              "id" : "152",
              "value" : true,
              "override" : false
            },
            "default_ssl_key" : {
              "id" : "158",
              "value" : "${$::apache::params::default_ssl_key}",
              "override" : false
            },
            "default_ssl_crl_check" : {
              "id" : "163",
              "value" : "",
              "override" : false
            },
            "default_ssl_crl" : {
              "id" : "162",
              "value" : "",
              "override" : false
            },
            "docroot" : {
              "id" : "201",
              "value" : "${$::apache::params::docroot}",
              "override" : false
            },
            "default_vhost" : {
              "id" : "153",
              "value" : true,
              "override" : true
            },
            "default_ssl_ca" : {
              "id" : "160",
              "value" : "",
              "override" : false
            },
            "default_ssl_crl_path" : {
              "id" : "161",
              "value" : "",
              "override" : false
            }
          },
          "id" : "23"
        }

      }
    },
    "stdlib" : {
      "puppetClasses" : {
        "stdlib::stages" : {
          "parameters" : { },
          "id" : "20"
        },
        "stdlib" : {
          "parameters" : { },
          "id" : "19"
        }
      }
    }
  }
}              
               </textarea>
             </div>
           </div>           
           <input name="projectId" type="hidden" th:value="${projectId}"/>        
       	</div>
       	<div class="modal-footer">
         	<button class="btn btn-default" data-dismiss="modal" type="button">Cancel</button>
			<button class="btn btn-primary" type="submit">Create</button>
       	</div>
       </form>
     </div>
   </div>
 </div>
 <div aria-hidden="true" aria-labelledby="myModalLabel" class="modal fade in" id="createEnvModal" role="dialog" tabindex="-1" style="padding-left: 15px;">
   <div class="modal-dialog">
     <div class="modal-content">
       <div class="modal-header">
         <button aria-hidden="true" class="close" data-dismiss="modal" type="button">&times;</button>
         <h4 class="modal-title" id="myModalLabel">Create Environment</h4>
       </div>
       <form th:attr="action=@{/ui/foreman/environment/new}" class="form-horizontal" id="new_env" method="post" role="form" data-toggle="validator">
	       <div class="modal-body">	         
	           <div class="alert alert-info alert-dismissible" role="alert">
				  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				  This widget allows to create an <strong>Environment</strong>. This Environment is a list of Puppet modules with their version. It can be used to chose the available modules when a Target is created. <br/>
				  To create an environment, you can choose an already existing Environment <strong>(Source Environment)</strong> to create a new one. It is faster than creating a new one from scratch. <br/>
				  An environment must have :
				  <ul>
				  	<li><strong>a Name</strong> : This is how you want to call the Environment.</li>
				  	<li><strong>a Description</strong> : You can describe the Environment you want. An example is already in the field. You can choose among already existing environment to prefill this field.</li>
				  </ul>
				</div>
	           <div class="form-group">
	             <label class="control-label col-sm-2" for="source">Source Environment</label>
	             <div class="col-sm-10">
	               <select class="form-control" id="env_source" onchange="selectSource()">
	               	<option value=""></option>
	               	<option th:each="env : ${environments}" th:value="${env.id}" th:text="${env.name}"></option>
	               </select>
	             </div>
	           </div>
	           <div class="form-group">
	           	<label class="control-label col-sm-2" for="source">Name</label>
	            <div class="col-sm-10">
	               <input class="form-control" id="envName" name="name" placeholder="Environment Name" type="text" required="required"/>
	            </div>
	           </div>
	           <div class="form-group">
	             <div class="col-sm-12">
	               <textarea class="form-control" id="env_configuration" name="configuration" rows="15" required="required">{
  "modules": [
    {
      "name": "",
      "version": ""
    }
  ]
}
	               </textarea>
	             </div>
	           </div>
	           <input name="projectId" type="hidden" th:value="${projectId}"/>	        
	       </div>
	       <div class="modal-footer">
	         <button class="btn btn-default" data-dismiss="modal" type="button">Cancel</button>
	         <button class="btn btn-primary" type="submit">Create</button>
	       </div>
     </form>
    </div>
  </div>
</div>


 <div aria-hidden="true" aria-labelledby="myModalLabel" class="modal fade in" id="instantiateHostModal" role="dialog" tabindex="-1" style="padding-left: 15px;">
   <div class="modal-dialog">
     <div class="modal-content">
       <div class="modal-header">
         <button aria-hidden="true" class="close" data-dismiss="modal" type="button">&times;</button>
         <h4 class="modal-title" id="myModalLabel">Instantiate Host</h4>
       </div>
       <div class="modal-body">
         <form th:attr="action=@{/ui/foreman/targets/instantiate}" class="form-horizontal" id="instantiate_host" method="post" role="form"  data-toggle="validator">
           <div class="form-group">
           		<label class="control-label col-sm-2" for="hostName">Name</label>
            		<div class="col-sm-10">
            			<input class="form-control" id="hostName" name="hostName" placeholder="Host Name" type="text" required="required"/>
            	</div>
           </div>
           <div class="form-group">
              	<label class="control-label col-sm-2" for="hostName">Password</label>
              	<div class="col-sm-10">
                	<input class="form-control" id="hostPass" name="hostPass" placeholder="rootroot" type="password" />
              	</div>
            	<input name="projectId" type="hidden" th:value="${projectId}"/>
            	<input name="targetId" id="targetId" type="hidden" value="" />
           </div>
	       <div class="modal-footer">
    	     <button class="btn btn-default" data-dismiss="modal" type="button">Cancel</button>
        	 <button class="btn btn-primary" type="submit">Instantiate</button>
       		</div>
         </form>
       </div>
     </div>
   </div>
 </div>
 
<script type="text/javascript" th:inline="text">

	var restAPI = {
        'puppetClassParameters': '[[@{/rest/foreman/puppet_class_parameters/}]]',
        'environments': '[[@{/rest/foreman/environments/}]]'
    }

	document.addEventListener("DOMContentLoaded", function(event) { 
	
		$(".btn-instantiate").click(function() {
			 var targetId = $(this).attr("data-targetId");
			 alert
			 $("#targetId").attr("value", targetId);
		});	

	});	

	function displayCreateTargetModal() {
		$('#createTargetModal').modal('show');
	}
	
	function displayCreateEnvModal() {
		$('#createEnvModal').modal('show');
	}
	
	function selectTargetEnvironment() {
		var sourceId = $('#environment').val();
		if (sourceId != "") {
		
			$.get(restAPI.puppetClassParameters+sourceId, function(data) {
				if (data) {
					$('#puppetConfiguration').val(data);
				}
			});
		}else{
			$('#env_configuration').val("");
		}
	}	
	
	function selectSource() {
		var sourceId = $('#env_source').val();
		if (sourceId != "") {
			$.get(restAPI.environments+sourceId, function(data) {
				if (data) {
					$('#env_configuration').val(data.configuration);
				}
			});
		}else{
			$('#env_configuration').val("");
		}
	}
	
</script>
